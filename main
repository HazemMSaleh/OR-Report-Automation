import pandas as pd

# Read the data from the Excel file into a pandas DataFrame
df = pd.read_excel('Z:\Compliance Reporting Team\Over Received ERS\Automation\Testing -Over Received Automation.xlsm', sheet_name= 'Paste sheet', converters={'PO#':str,'Line item':str})

# Get a list of buyer names
buyer_names = df['Buyer Name'].unique()

# Loop through each buyer name
for name in buyer_names:
  # Filter the report data dataframe to only include rows with the current buyer name
   filtered_df = df[df['Buyer Name'] == name]

  #Define the files we are writing to (use try to create file if none present)
   buyer_path = 'Z:\Compliance Reporting Team\Over Received ERS\Automation\data\\' + name + ".xlsx"
   try:
     pd.read_excel(buyer_path)
   except FileNotFoundError:
     filtered_df.to_excel(buyer_path, index=False)

  #add a comments column
   filtered_df = filtered_df.assign(Comments =None) 
  #add a concat column so we can later pull comments
   filtered_df = filtered_df.assign(Concat = filtered_df['PO#'] + filtered_df["Line item"])
  #Save the current(old) data in the buyer sheet
   old_data = filtered_df
  #**next** need to use a join to pull in comments from old_data into filtered_df on concat
   filtered_df.merge(old_data, on= 'Concat', how='left')
  # Write the filtered DataFrame to a new Excel file with the name of the buyer
   filtered_df.to_excel(buyer_path, index=False)
   if name == "Allen Scott":
    print(old_data)

